<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CMSIS-Driver Validation: SPI Server</title>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="tabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_search.css" rel="stylesheet" type="text/css"/>
<link href="extra_tabs.css" rel="stylesheet" type="text/css"/>
<link href="version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../version.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1.5em;"><a href="https://www.keil.arm.com/cmsis" target="_blank"><img alt="Logo" src="cmsis_logo_white_small.png"/</a></td>
  <td style="padding-left: 1em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">CMSIS-Driver Validation
   &#160;<span id="projectnumber"><script type="text/javascript">
     <!--
     writeHeader.call(this);
     writeVersionDropdown.call(this, "CMSIS-Driver Validation");
     //-->
    </script>
   </span>
   </div>
   <div id="projectbrief">Driver Validation</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="CMSISnav" class="tabs1">
  <ul class="tablist">
    <script type="text/javascript">
      writeComponentTabs.call(this);
    </script>
  </ul>
</div>
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('group__spi__server.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">SPI Server<div class="ingroups"><a class="el" href="group__dv__spi.html">SPI Validation</a></div></div></div>
</div><!--header-->
<div class="contents">
<p>The <b>SPI Server</b> application provides features used by the CMSIS-Driver Validation suite to test physical operation of the SPI driver.</p>
<p>It is available for the STMicroelectronics <b>STM32F429I-DISC1</b> board and as a template for <b>any board</b> with available <b>Board Layer</b> and configured <b>CMSIS compliant SPI driver</b>.</p>
<dl class="section note"><dt>Note</dt><dd>STM32F429I-DISC1 was selected because its SPI driver is stable and supports all required features. </dd>
<dd>
For running on STM32F429I-DISC1 board, see <a class="el" href="#spi_server_disc1">Running on STM32F429I-DISC1 board</a>. </dd>
<dd>
For running on other hardware, see <a class="el" href="#spi_server_template">Running on specific hardware</a>.</dd></dl>
<h1><a class="anchor" id="spi_server_features"></a>
Features</h1>
<ul>
<li>Read <b>version</b> information</li>
<li>Read <b>capabilities</b> information (auto-detected)</li>
<li>Set and read <b>buffer</b> contents</li>
<li>Read last <b>transfer count</b></li>
<li>Execute <b>transfer</b> in <b>Slave</b> or <b>Master</b> mode</li>
</ul>
<h1><a class="anchor" id="spi_server_oper"></a>
Operation</h1>
<p>The Server waits for a command from the SPI Client (Driver Validation), executes it, and then waits for the next one. Most commands have no additional data phase, though some do. The Server operates as an SPI <b>Slave</b> except when a <b>Master</b> transfer is explicitly requested; after completing it, the Server returns to <b>Slave</b> mode.</p>
<h1><a class="anchor" id="spi_server_config"></a>
Configuration</h1>
<p>Communication settings are defined in <b>SPI_Server_Config.h</b> file. </p><div class="image">
<img src="spi_server_config_h.png" alt=""/>
<div class="caption">
SPI_Server_Config.h configuration file in Configuration Wizard view mode</div></div>
<h2><a class="anchor" id="spi_server_config_detail"></a>
Configuration settings</h2>
<ul>
<li><b>Driver_SPI#</b> — selects the driver instance used by the Server.</li>
<li><b>Communication settings</b> (fixed for command exchange):<ul>
<li><b>Mode:</b> Slave with <b>hardware-monitored Slave Select</b></li>
<li><b>Clock/Frame:</b> Clock Polarity 0/ Clock Phase 0</li>
<li><b>Data Bits:</b> 8</li>
<li><b>Bit Order:</b> MSB to LSB</li>
</ul>
</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The SPI Server receives commands as an SPI <b>Slave</b> using the <b>Slave Select</b> line. The Server’s SPI driver <b>must support hardware-monitored Slave Select</b> functionality.</dd></dl>
<h1><a class="anchor" id="spi_server_commands"></a>
Commands</h1>
<p>Commands are human-readable (ASCII) for simpler analysis with an SPI bus analyzer.</p>
<ul>
<li><b>GET VER</b> — get Server version</li>
<li><b>GET CAP</b> — get capabilities (auto-detected)</li>
<li><b>SET BUF</b> — initialize Rx/Tx buffer content</li>
<li><b>GET BUF</b> — retrieve Rx/Tx buffer content</li>
<li><b>SET COM</b> — specify transfer configuration for the next <b>XFER</b></li>
<li><b>XFER</b> — trigger a transfer</li>
<li><b>GET CNT</b> — retrieve number of transferred items in the last transfer</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>For detailed command descriptions, see <b>README.md</b> in project root.</dd></dl>
<p>Example capture (Master transfer validation): </p><div class="image">
<img src="spi_bus_master_ss_hw_ctrl_out.png" alt="" width="100%"/>
</div>
<h1><a class="anchor" id="spi_server_disc1"></a>
Running on STM32F429I-DISC1 board</h1>
<p>Using the <a href="https://marketplace.visualstudio.com/items?itemName=Arm.cmsis-csolution">Arm CMSIS Solution</a> VS Code extension, create a new solution from <b>example</b>:</p>
<ol type="1">
<li>In the <b>CMSIS</b> extension, click <b>Create a New Solution</b>. <div class="image">
<img src="server_new_sol_create.png" alt=""/>
</div>
</li>
<li>Select an <b>STM32F429I-DISC1 board</b> as a <b>Target Board</b>.</li>
<li>Under <b>Templates, Reference Applications, and Examples</b>, select <b>SPI Server (CMSIS-Driver Validation SPI Server application for STM32F429I-DISC1 board)</b>. <div class="image">
<img src="spi_server_new_sol_disc1_example.png" alt=""/>
</div>
</li>
<li>Choose <b>Solution Base Folder</b> and click <b>Create</b>. <div class="image">
<img src="spi_server_new_sol_disc1_create.png" alt=""/>
</div>
</li>
<li>Build and run the <b>SPI Server application</b> on the <b>STM32F429I-DISC1 board</b>.</li>
</ol>
<p><b>SPI1 pinout (STM32F429I-DISC1):</b> </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">SPI function   </th><th class="markdownTableHeadCenter">Pin    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">SPI Clock   </td><td class="markdownTableBodyCenter">PA5    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Master Output Slave Input (MOSI)   </td><td class="markdownTableBodyCenter">PA7    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Master Input Slave Output (MISO)   </td><td class="markdownTableBodyCenter">PB4    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Slave Select   </td><td class="markdownTableBodyCenter">PA15   </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd><b>IMPORTANT:</b> Connect <b>ground between</b> the <b>SPI Server</b> and the <b>Device (Driver) Under Test</b> to ensure a common reference potential. </dd>
<dd>
The STM32F429I-DISC1 SPI Server does <b>not</b> support National Semiconductor <b>Microwire</b> frame format. </dd>
<dd>
The STM32F429I-DISC1 SPI Server for <b>build-type: Debug</b> displays command execution on an on-board LCD.</dd></dl>
<h1><a class="anchor" id="spi_server_template"></a>
Running on specific hardware</h1>
<p>Using the <a href="https://marketplace.visualstudio.com/items?itemName=Arm.cmsis-csolution">Arm CMSIS Solution</a> VS Code extension, create a new solution from <b>template</b>:</p>
<ol type="1">
<li>In the <b>CMSIS</b> extension, click <b>Create a New Solution</b>. <div class="image">
<img src="server_new_sol_create.png" alt=""/>
</div>
</li>
<li>Select the <b>Target Board</b>. <br  />
</li>
<li>Under <b>Templates, Reference Applications, and Examples</b>, select <b>SPI Server (CMSIS-Driver Validation SPI Server application)</b>. <div class="image">
<img src="spi_server_new_sol_template.png" alt=""/>
</div>
</li>
<li>Choose <b>Solution Base Folder</b>, click <b>Create</b>. <div class="image">
<img src="spi_server_new_sol_create.png" alt=""/>
</div>
</li>
<li>Select the board layer that provides an SPI Driver. <div class="image">
<img src="server_new_sol_layer.png" alt=""/>
</div>
</li>
<li>If SPI is not routed to ARDUINO (or a different SPI peripheral is required), open <b>SPI_Server_Config.h</b>, <b>Open Preview</b> and edit <b>Driver_SPI#</b> to the required instance.</li>
<li>Build and run the <b>SPI Server application</b> on your hardware.</li>
</ol>
<dl class="section note"><dt>Note</dt><dd><b>IMPORTANT:</b> The target board’s SPI CMSIS-Driver must be <b>fully CMSIS compliant</b>! </dd>
<dd>
The SPI Server for <b>build-type: Debug</b> displays command execution on an STDOUT channel (typically Virtual COM port via Debug adapter).</dd></dl>
<h1><a class="anchor" id="spi_server_troubleshooting"></a>
Troubleshooting</h1>
<ol type="1">
<li><b>Server not responding</b><ul>
<li>Reset the Server.</li>
<li>Verify the correct driver instance in <code>SPI_Server_Config.h</code>.</li>
<li>Reduce bus speed used for communication with the Server (in <code>DV_SPI_Config.h</code>).</li>
</ul>
</li>
<li>Debug message <b>“Server Start failed!”</b> (build-type: Debug)<ul>
<li>Check heap (must be &gt; <code>2 * SPI_SERVER_BUF_SIZE</code>).</li>
<li>Verify RTOS allows ≥ <b>512 bytes</b> allocation for the Server main thread (e.g., <em>Global Dynamic Memory size</em> in <code>RTX_Config.h</code> if RTX5).</li>
<li>Ensure the Server’s SPI driver supports all fixed settings (Slave with hardware-monitored Slave Select, CPOL=0/CPHA=0, 8 bits, MSB to LSB).</li>
</ul>
</li>
<li><b>Tests report data mismatch</b><ul>
<li>Ensure Slave Select line has a pull-up to Vcc (3.3 V).</li>
<li>Keep <b>wires short and separate</b>; pair SCK and GND if possible.</li>
<li>Ensure the SPI driver does not drive Slave Select line while inactive. </li>
</ul>
</li>
</ol>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <script type="text/javascript">
        <!--
        writeFooter.call(this);
        //-->
      </script> 
    </li>
  </ul>
</div>
</body>
</html>
