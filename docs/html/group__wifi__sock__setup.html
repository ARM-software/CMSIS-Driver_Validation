<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>WiFi SockServer</title>
<title>CMSIS-Driver Validation: WiFi SockServer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="drv.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylsheetf" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 46px;">
  <td id="projectlogo"><img alt="Logo" src="keilarm.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">CMSIS-Driver Validation
   &#160;<span id="projectnumber">Version 1.4.0</span>
   </div>
   <div id="projectbrief">Driver Validation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="DRVnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Usage&#160;and&#160;Description</span></a></li>
      <li><a href="modules.html"><span>Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__wifi__sock__setup.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">WiFi SockServer<div class="ingroups"><a class="el" href="group__wifi__funcs.html">WiFi Validation</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>The <b>SockServer</b> is an application providing a set of services used by the WiFi CMSIS-Driver Validation suite to test the Socket interface of the WiFi driver. It is located in the <b>.\Tools\SockServer</b> subdirectory of the pack root directory. The SockServer is available for different target systems. It runs several standard network services.</p>
<p>The SockServer is available for following target systems:</p>
<ul>
<li><b>Personal Computer</b> running Microsoft Windows (executable located in <b>.\Tools\SockServer\PC\Win</b>)</li>
<li><b>Keil MCB4300</b> evaluation board (µVision project located in <b>.\Tools\SockServer\Embedded\MDK\Board\MCB4300</b>)</li>
<li><b>Keil MCBSTM32F400</b> evaluation board (µVision project located in <b>.\Tools\SockServer\Embedded\MDK\Board\MCBSTM32F400</b>)</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>To run SockServer in an embedded system, you need a license for MDK-Professional (for the MDK-Middleware Network component).</dd></dl>
<p>The following services are available by SockServer:</p>
<ul>
<li><b>Echo</b> service on port <span class="XML-Token">7</span>, TCP and UDP <br/>
 (two instances of TCP service, one instance of UDP service)</li>
<li><b>Discard</b> service on port <span class="XML-Token">9</span>, TCP and UDP <br/>
 (one instance of TCP service, one instance of UDP service)</li>
<li><b>Chargen</b> service on port <span class="XML-Token">19</span>, TCP and UDP <br/>
 (two instances of TCP service, one instance of UDP service)</li>
<li><b>Assistant</b> service on port <span class="XML-Token">5000</span> <br/>
 (helper service used to test WiFi sockets in server mode (socket accept functionality))</li>
<li><b>Telnet</b> service on port <span class="XML-Token">23</span> <br/>
 (SockServer status monitoring service)</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>SockServer provides the Telnet service only in embedded systems.</dd></dl>
<h1><a class="anchor" id="sockserver_pc"></a>
SockServer for PC running Microsoft Windows</h1>
<p><b>Requirements:</b> </p>
<ul>
<li>Personal Computer running Microsoft Windows</li>
<li>PC connection to local network</li>
</ul>
<p>SockServer is already built and can be executed by running the SockServer.exe file in <b>.\Tools\SockServer\PC\Win</b></p>
<p>If you need to change the functionality of SockServer, source files and a batch script for building the executable are available in <b>.\Tools\SockServer\PC\Win</b>.</p>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>SockServer build process requires Minimalist GNU for Windows (MinGW).</li>
<li>To build the SockServer executable for Windows, follow these steps:<ul>
<li>Download and install MinGW from <a href="https://osdn.net/projects/mingw/releases/">https://osdn.net/projects/mingw/releases/</a></li>
<li>Set environment path in Microsoft Windows as explained under Environment Settings heading on <a href="http://www.mingw.org/wiki/Getting_Started">http://www.mingw.org/wiki/Getting_Started</a></li>
<li>Run <b>Build.bat</b> located in <b>.\Tools\SockServer\PC\Win</b> which will result in an executable that is located in <b>.\Tools\SockServer\PC\Win</b></li>
</ul>
</li>
</ul>
</dd></dl>
<h2><a class="anchor" id="sockserver_pc_win_troubleshooting"></a>
Troubleshooting</h2>
<p>Problems and solutions:</p>
<ol type="1">
<li>SockServer not responding to requests<ul>
<li>Open Windows firewall -&gt; Advanced settings<ul>
<li>select inbound rules</li>
</ul>
</li>
<li>create a new custom rule (New Rule...)<ul>
<li>Rule type: Program</li>
<li>Program: This program path (select path to SockServer.exe)</li>
<li>Action: Allow the connection</li>
<li>Profile: Domain, Private (Public not advised)</li>
<li>Name: SockServer</li>
</ul>
</li>
</ul>
</li>
<li>Test computer not responding to ping<ul>
<li>Open Windows firewall -&gt; Advanced settings<ul>
<li>select inbound rules, enable rule File and Printer sharing (Echo request - ICMPv4-In)</li>
</ul>
</li>
<li>If rule does not exist, create a new custom rule (New Rule...)<ul>
<li>Rule type: Custom</li>
<li>Program: All programs</li>
<li>Protocol type: ICMPv4</li>
<li>ICMP Settings: Customize - Specific ICMP types: Echo Request</li>
<li>Scope: Any IP address</li>
<li>Action: Allow the connection</li>
<li>Profile: Domain, Private (Public not advised)</li>
<li>Name: Ping Echo</li>
</ul>
</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="sockserver_embedded"></a>
SockServer for embedded systems</h1>
<p><b>Requirements:</b> </p>
<ul>
<li>Keil MCB4300 or Keil MCBSTM32F400 evaluation board</li>
<li>Wired Ethernet connection to local network</li>
</ul>
<h2><a class="anchor" id="sockserver_embedded_telnet"></a>
Using the Telnet service</h2>
<p>The Telnet service provides information about received and sent data. This can help to resolve driver problems when WiFi socket sending and receiving does not work. For example, when the transfer test fails, either <b>SocketSend</b> or <b>SocketRecv</b> functions may have failed or both.</p>
<p>For the Telnet connection from the PC, open a CMD window. At the prompt, type the following command or use another Telnet client application: </p>
<div class="fragment"><div class="line">c:\&gt;telnet sockserver</div>
</div><!-- fragment --><p>The initial page opens: </p>
<div class="image">
<img src="SockServer.png" alt="SockServer.png"/>
<div class="caption">
Initial telnet connection</div></div>
<p> You can view the remote IP address, port number, receiving and transmitting counters with the <b>stat</b> command: </p>
<div class="image">
<img src="SockMonitor.png" alt="SockMonitor.png"/>
<div class="caption">
Status monitoring</div></div>
<p> Status monitor constantly updates the SockServer status on the screen. To stop the screen update, press any telnet client key.</p>
<dl class="section note"><dt>Note</dt><dd>You might need to enable the Telnet service in Windows 10 first. Here's a <a href="https://www.technipages.com/windows-10-enable-telnet" target="_blank">tutorial</a> on how to do this.</dd></dl>
<h2><a class="anchor" id="sockserver_embedded_porting"></a>
Porting SockServer to other targets</h2>
<p>Currently, the <b>SockServer</b> application is available for the <b>MCB4300</b> and <b>MCBSTM32F400</b> evaluation boards. To create SockServer application for a different target device, follow the steps below:</p>
<ol type="1">
<li>Create new network project in µVision</li>
<li>Select and configure the following software components:<ul>
<li><b>Network:Core</b> and configure the host name and pool size in <b>Net_Config.c</b> <div class="fragment"><div class="line"><span class="preprocessor">#define NET_HOST_NAME               &quot;SockServer&quot;</span></div>
<div class="line"><span class="preprocessor">#define NET_MEM_POOL_SIZE           16384</span></div>
</div><!-- fragment --></li>
<li><b>Network:Interface:Ethernet</b> and configure the MAC address in <b>Net_Config_ETH0.h</b> to avoid collisions <div class="fragment"><div class="line"><span class="preprocessor">#define ETH0_MAC_ADDR               &quot;1E-30-6C-A2-45-5A&quot;</span></div>
</div><!-- fragment --></li>
<li><b>Network:Socket:BSD</b> and configure number of sockets in <b>Net_Config_BSD.h</b> <div class="fragment"><div class="line"><span class="preprocessor">#define BSD_NUM_SOCKS               8</span></div>
<div class="line"><span class="preprocessor">#define BSD_SERVER_SOCKS            4</span></div>
</div><!-- fragment --></li>
<li><b>Network:Socket:TCP</b> and configure number of sockets in <b>Net_Config_TCP.h</b> <div class="fragment"><div class="line"><span class="preprocessor">#define TCP_NUM_SOCKS               9</span></div>
</div><!-- fragment --></li>
<li><b>Network:Socket:UDP</b> and configure number of sockets in <b>Net_Config_UDP.h</b> <div class="fragment"><div class="line"><span class="preprocessor">#define UDP_NUM_SOCKS               10</span></div>
</div><!-- fragment --></li>
<li><b>Network:Service:Telnet</b> server and disable authentication in <b>Net_Config_Telnet_Server.h</b> <div class="fragment"><div class="line"><span class="preprocessor">#define TELNET_SERVER_AUTH_ENABLE   0</span></div>
</div><!-- fragment --></li>
<li><b>CMSIS</b> <b>Driver:Ethernet/MAC/PHY</b>(API) depending on your hardware</li>
</ul>
</li>
<li>Configure device specific hardware:<ul>
<li>Configure the CMSIS-Driver for Ethernet and other device specific components (clock system, I/O, ...) as required. Please consult your device's/board's documentation for more information.</li>
</ul>
</li>
<li>Copy and add <b>SockServer.c</b> and <b>SockServer.h</b> files to the project</li>
<li>Copy and add <b>Telnet_Server_UIF.c</b> to the project</li>
<li>Add the code to start the services in <b>main.c</b> <div class="fragment"><div class="line"><span class="comment">// Application main thread</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_main (<span class="keywordtype">void</span> *argument) {</div>
<div class="line"> </div>
<div class="line">  netInitialize ();</div>
<div class="line">  osDelay (500);</div>
<div class="line"> </div>
<div class="line">  osThreadNew(DgramServer,   NULL, NULL);</div>
<div class="line">  osThreadNew(StreamServer,  NULL, NULL);</div>
<div class="line">  osThreadNew(TestAssistant, NULL, NULL);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>Increase the default RTX stack size to 400 bytes in <b>RTX_Config.h</b> <div class="fragment"><div class="line"><span class="preprocessor">#define OS_STACK_SIZE           400</span></div>
</div><!-- fragment --></li>
<li>Set the default global stack to 1024 bytes and heap to 6144 bytes in your device's <b>startup</b> <b>file</b> <div class="fragment"><div class="line">Stack_Size      EQU     0x00000400</div>
<div class="line">Heap_Size       EQU     0x00001800</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="sockserver_embedded_troubleshooting"></a>
Troubleshooting</h2>
<p>Problems and solutions:</p>
<ol type="1">
<li>SockServer on multiple embedded systems on the same local network<ul>
<li>Set unique ETH0_MAC_ADDR in Net_Config_ETH0.h for each embedded system in embedded system project </li>
</ul>
</li>
</ol>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Dec 2 2019 12:02:23 for CMSIS-Driver Validation by ARM Ltd. All rights reserved.
	<!--
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 
	-->
	</li>
  </ul>
</div>
</body>
</html>
