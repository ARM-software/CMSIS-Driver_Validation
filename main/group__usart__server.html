<!-- HTML header for doxygen 1.9.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CMSIS-Driver Validation: USART Server</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="footer.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="version.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="../version.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1.5em;"><img alt="Logo" src="cmsis_logo_white_small.png"/></td>
  <td style="padding-left: 1em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">CMSIS-Driver Validation
&#160;<span id="projectnumber"><script type="text/javascript">
     <!--
     writeHeader.call(this);
     writeVersionDropdown(this);
     //-->
    </script>
   </span>
   </div>
   <div id="projectbrief">Driver Validation</div>
  </td>
  <!--END !PROJECT_NAME-->
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__usart__server.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle"><div class="title">USART Server<div class="ingroups"><a class="el" href="group__dv__usart.html">USART Validation</a></div></div></div>
</div><!--header-->
<div class="contents">
<p >The <b>USART Server</b> is an application providing a set of features used by the CMSIS-Driver Validation suite to test the physical operation of the USART driver.<br  />
 It is located in the <code>&lt;pack root directory&gt;</code><b>\Tools\USART_Server</b> directory.</p>
<p >The USART Server offers the following features:</p><ul>
<li>read of the <b>version</b> information</li>
<li>read of the <b>capabilities</b> information</li>
<li>set and read of the <b>data buffers content</b></li>
<li>read of the last <b>send/receive/transfer count</b></li>
<li><b>send</b> of data</li>
<li><b>reception</b> of data</li>
<li><b>transfer</b> in synchronous mode</li>
<li>generation of <b>break</b> signal</li>
<li>read of <b>break</b> signal status</li>
<li>control of <b>modem lines</b></li>
<li>read of <b>modem lines</b> state</li>
</ul>
<h1><a class="anchor" id="usart_server_oper"></a>
Operation</h1>
<p >The USART Server is continuously waiting on a command from the USART Client (Driver Validation), after the command is received it is executed, and the process repeats.<br  />
 Most commands do not have any additional related data phase, but some do have additional input or output data exchange phase following the command.</p>
<h1><a class="anchor" id="usart_server_config"></a>
Configuration</h1>
<p >Communication interface settings used during command exchange are set in the <b>USART_Server_Config.h</b> configuration file. </p><div class="image">
<img src="usart_server_config_h.png" alt=""/>
<div class="caption">
USART_Server_Config.h configuration file in Configuration Wizard view mode</div></div>
<h2><a class="anchor" id="usart_server_config_detail"></a>
Configuration settings</h2>
<p ><b>Driver_USART#</b> selects the driver instance used by the USART Server.<br  />
 <b>Communication settings</b> specify the communication parameters for command exchange with the USART Client:</p><ul>
<li><b>Mode</b> setting specifies the mode used for command exchange. Different modes require different physical connection and also USART Server must use same setting.<br  />
 For details on modes please check <a class="el" href="group__dv__usart.html#usart_server_con">USART Server connection</a>.</li>
</ul>
<p >Fixed communication settings used for command exchange with the USART Client are:</p><ul>
<li><b>Baudrate: 115200</b></li>
<li><b>Data Bits: 8</b></li>
<li><b>Parity: None</b></li>
<li><b>Stop Bits: 1</b></li>
<li><b>Flow Control: None</b></li>
</ul>
<h1><a class="anchor" id="usart_server_commands"></a>
Commands</h1>
<p >Commands are encoded in human readable format (ASCII strings) so they can be viewed by the USART bus analyzer and analyzed more easily.</p>
<p >Supported commands:</p><ul>
<li><b>GET VER</b>: used to retrieve the version of the USART Server application</li>
<li><b>GET CAP</b>: used to retrieve the capabilities of the USART Server (the Server auto-detects capabilities upon reception of this command)</li>
<li><b>SET BUF</b>: used for initialization of the content of receive or transmit buffer of the USART Server</li>
<li><b>GET BUF</b>: used for retrieving the content of receive or transmit buffer of the USART Server</li>
<li><b>SET COM</b>: used for specifying configuration of the send/receive/transfer activated by the XFER command</li>
<li><b>XFER</b>: used to trigger a send/receive/transfer (parameters specified with the last SET COM command)</li>
<li><b>GET CNT</b>: used to retrieve the number of sent/received/transferred items in previous send/receive/transfer</li>
<li><b>SET BRK</b>: used to instruct USART Server to generate break signal</li>
<li><b>GET BRK</b>: used to retrieve break signal status on the USART Server</li>
<li><b>SET MDM</b>: used for activation of modem lines</li>
<li><b>GET MDM</b>: used to retrieve modem lines status on the USART Server</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>For details about commands please refer to <b>Abstract.txt</b> file in the <code>&lt;pack root directory&gt;</code>\Tools\USART_Server\Board\MCBSTM32F400 directory.</dd></dl>
<p>Picture below shows a capture of USART Driver Validation validating functionality of the Send function in the Asynchronous mode </p><div class="image">
<img src="usart_bus_async_send.png" alt=""/>
</div>
<h1><a class="anchor" id="usart_server_porting"></a>
Porting USART Server to other targets</h1>
<p >To create USART Server application for a different target device, follow the steps below:</p><ol type="1">
<li>Create a new project in µVision for your target device</li>
<li>In the RTE window enable and configure the following software components:<ul>
<li><b>CMSIS: CORE</b></li>
<li><b>CMSIS: RTOS2 (API): Keil RTX5</b> any variant</li>
<li><b>CMSIS Driver: USART (API)</b></li>
<li><b>CMSIS Driver: VIO (API)</b> select <b>Virtual</b> implementation if implementation for your target system is not available</li>
<li>Generic device specific components (startup, clock system, I/O, ...) as required (please consult device's documentation for more information)</li>
<li>Resolve any unresolved dependencies between components</li>
</ul>
</li>
<li>Copy the <b>USART_Server.c</b> file from the <code>&lt;pack root directory&gt;</code><b>\Tools\USART_Server\Source</b> directory to the project root and add it to µVision project</li>
<li>Copy the <b>USART_Server.h</b> file from the <code>&lt;pack root directory&gt;</code><b>\Tools\USART_Server\Include</b> directory to the project root</li>
<li>Copy the files specified below from the directory <code>&lt;pack root directory&gt;</code><b>\Tools\USART_Server\Config</b> to the project root:<ul>
<li><b>USART_Server_Config.h</b>: also adapt this file as required by your device</li>
<li><b>USART_Server_HW.c</b>: add this file to the µVision project also adapt it for your device's specific handling of the GPIO lines for testing of the DCD and RI lines</li>
</ul>
</li>
<li>Add root of the project to include path (<b>Options for Target</b> -&gt; <b>C/C++</b> -&gt; <b>Include Paths: .\</b>)</li>
<li>Add the <b>main.c</b> file from a template (Right-click <b>Source Group 1...</b> and select <b>Add New Item to Group</b>, select <b>User Code Template</b> and choose the <b>CMSIS-RTOS2 'main' function</b> file from <b>CMSIS: RTOS2:Keil RTX5</b>) and update with code snippet below (replace <code>app_main</code> function): <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;USART_Server.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*----------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> * Application main thread</span></div>
<div class="line"><span class="comment"> *---------------------------------------------------------------------------*/</span></div>
<div class="line">__NO_RETURN <span class="keyword">static</span> <span class="keywordtype">void</span> app_main (<span class="keywordtype">void</span> *argument) {</div>
<div class="line">  (void)argument;</div>
<div class="line">  USART_Server_Start();</div>
<div class="line">  <span class="keywordflow">for</span> (;;) {}</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>Build and download the ported USART Server application to the target device</li>
</ol>
<h1><a class="anchor" id="usart_server_troubleshooting"></a>
Troubleshooting</h1>
<p >Problems and solutions:</p><ol type="1">
<li>USART Server is not responding to commands<ul>
<li>reset the USART Server</li>
<li>check that correct driver instance is selected in the USART_Server_Config.h file</li>
<li>check that communication settings (mode) between USART Server and USART Driver Validation are the same,<br  />
 if they are not, correct them, rebuild the application and download to the hardware</li>
</ul>
</li>
<li>USART Server is not responding to commands it reports "Server Start failed!" message if debug variant is used<ul>
<li>check heap settings (it has to be larger than 2 * USART_SERVER_BUF_SIZE specified in the USART_Server_Config.h file)</li>
<li>check that RTOS allows allocation of at least 512 bytes for the USART Server main thread (Global Dynamic Memory size [bytes] setting in RTX_Config.h file if RTX5 is used)</li>
<li>check that USART driver used for USART Server supports selected mode and all fixed settings:<ul>
<li>Baudrate: 115200</li>
<li>Data Bits: 8</li>
<li>Parity: None</li>
<li>Stop Bits: 1</li>
<li>Flow Control: None</li>
</ul>
</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="usart_server_MCBSTM32F400"></a>
USART Server on the Keil MCBSTM32F400</h1>
<p >µVision project and source files for the MCBSTM32F400 board are available in the <code>&lt;pack root directory&gt;</code><b>\Tools\USART_Server\Board\MCBSTM32F400</b> directory.</p>
<p >On the Keil MCBSTM32F400 the <b>USART1</b> interface is used, with the following pinout:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">USART function   </th><th class="markdownTableHeadCenter">Pin    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Tx   </td><td class="markdownTableBodyCenter">PB6    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Rx   </td><td class="markdownTableBodyCenter">PB7    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">CLK (synchro)   </td><td class="markdownTableBodyCenter">PA8    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">CTS   </td><td class="markdownTableBodyCenter">PA11    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">RTS   </td><td class="markdownTableBodyCenter">PA12    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">DCD test pin   </td><td class="markdownTableBodyCenter">PA9    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">RI test pin   </td><td class="markdownTableBodyCenter">PA10   </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>IMPORTANT: Ground must be connected between USART Server and Device (Driver) Under Test so that USART signals have same ground potential.</dd></dl>
<p>For more information please consult <b>Abstract.txt</b> file in the project root.</p>
<dl class="section note"><dt>Note</dt><dd>For synchronous mode testing this device's hardware supports only synchronous Master mode, so it can only be used for testing synchronous Slave mode of the Driver Under Test.</dd></dl>
<h1><a class="anchor" id="usart_server_STM32F429I_DISC1"></a>
USART Server on the STMicroelectronics STM32F429I-DISC1 (32F429IDISCOVERY) board</h1>
<p >µVision project and source files for the STM32F429I-DISC1 board are available in the <code>&lt;pack root directory&gt;</code><b>\Tools\USART_Server\Board\STM32F429I-DISC1</b> directory.</p>
<p >On the STMicroelectronics STM32F429I-DISC1 board the <b>USART1</b> interface is used, with the following pinout:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">USART function   </th><th class="markdownTableHeadCenter">Pin    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Tx   </td><td class="markdownTableBodyCenter">PA9    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Rx   </td><td class="markdownTableBodyCenter">PA10    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">CLK (synchro)   </td><td class="markdownTableBodyCenter">PA8    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">CTS   </td><td class="markdownTableBodyCenter">PA11    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">RTS   </td><td class="markdownTableBodyCenter">PA12    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">DCD test pin   </td><td class="markdownTableBodyCenter">PA13    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">RI test pin   </td><td class="markdownTableBodyCenter">PA14   </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>IMPORTANT: Ground must be connected between USART Server and Device (Driver) Under Test so that USART signals have same ground potential.</dd></dl>
<p>For more information please consult <b>Abstract.txt</b> file in the project root.</p>
<dl class="section note"><dt>Note</dt><dd>For synchronous mode testing this device's hardware supports only synchronous Master mode, so it can only be used for testing synchronous Slave mode of the Driver Under Test. </dd></dl>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <script type="text/javascript">
        <!--
        writeFooter.call(this);
        //-->
      </script>
    </li>
  </ul>
</div>
</body>
</html>
